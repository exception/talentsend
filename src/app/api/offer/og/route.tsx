import { getOfferAndTeamViaEdge } from '@/lib/planetscale';
import { ImageResponse, type NextRequest } from 'next/server';

const interBold = fetch(
    new URL('../../../../assets/fonts/Inter-Bold.ttf', import.meta.url),
).then((res) => res.arrayBuffer());

export const runtime = 'edge';

export async function GET(request: NextRequest) {
    const interBoldFont = await interBold;

    const searchParams = request.nextUrl.searchParams;
    const offerId = searchParams.get('offerId');

    if (!offerId) {
        return new ImageResponse(<></>);
    }

    const offer = await getOfferAndTeamViaEdge(offerId);

    if (!offer) {
        return new ImageResponse(<></>);
    }

    return new ImageResponse(
        (
            <div tw="flex flex-col w-full h-full justify-center items-center bg-[#1A3008]">
                <div tw="flex w-full">
                    <div tw="flex flex-col w-full justify-between px-[74px]">
                        <div tw="flex flex-row items-center">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="28"
                                height="28"
                                viewBox="0 0 28 28"
                                fill="none"
                            >
                                <rect
                                    y="3.59045"
                                    width="23.8048"
                                    height="6.49222"
                                    fill="#EEF9E4"
                                />
                                <rect
                                    x="2.16406"
                                    y="20.903"
                                    width="23.8048"
                                    height="6.49222"
                                    transform="rotate(-45 2.16406 20.903)"
                                    fill="#EEF9E4"
                                />
                                <rect
                                    x="17.3125"
                                    y="27.3952"
                                    width="23.8048"
                                    height="6.49222"
                                    transform="rotate(-90 17.3125 27.3952)"
                                    fill="#EEF9E4"
                                />
                                <rect
                                    x="27.0508"
                                    y="10.0825"
                                    width="6.49222"
                                    height="6.49222"
                                    rx="3.24611"
                                    transform="rotate(180 27.0508 10.0825)"
                                    fill="#9FFB4F"
                                />
                                <rect
                                    x="23.8047"
                                    y="10.0826"
                                    width="6.49222"
                                    height="6.49222"
                                    transform="rotate(180 23.8047 10.0826)"
                                    fill="#9FFB4F"
                                />
                                <rect
                                    x="23.8047"
                                    y="6.83643"
                                    width="6.49222"
                                    height="6.49222"
                                    rx="3.24611"
                                    transform="rotate(180 23.8047 6.83643)"
                                    fill="#9FFB4F"
                                />
                            </svg>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="223"
                                height="32"
                                viewBox="0 0 223 32"
                                fill="none"
                            >
                                <path
                                    d="M207.931 31.8156C206.189 31.8156 204.606 31.3647 203.182 30.463C201.758 29.5613 200.62 28.2088 199.77 26.4054C198.919 24.602 198.494 22.3631 198.494 19.6888C198.494 16.9119 198.935 14.627 199.816 12.8338C200.697 11.0407 201.85 9.71374 203.274 8.85303C204.709 7.99232 206.251 7.56196 207.9 7.56196C209.14 7.56196 210.201 7.77714 211.082 8.20749C211.963 8.6276 212.691 9.17067 213.265 9.8367C213.838 10.5027 214.274 11.1944 214.571 11.9116H214.725V0H222.241V31.4774H214.802V27.6503H214.571C214.253 28.3778 213.802 29.0592 213.218 29.6945C212.634 30.3298 211.902 30.8421 211.021 31.2315C210.15 31.6209 209.12 31.8156 207.931 31.8156ZM210.544 25.9597C211.456 25.9597 212.235 25.7035 212.88 25.1912C213.526 24.6686 214.023 23.936 214.371 22.9933C214.72 22.0506 214.894 20.944 214.894 19.6734C214.894 18.3823 214.72 17.2706 214.371 16.3381C214.033 15.4057 213.536 14.6884 212.88 14.1864C212.235 13.6843 211.456 13.4332 210.544 13.4332C209.612 13.4332 208.823 13.6894 208.177 14.2017C207.532 14.7141 207.04 15.4364 206.702 16.3689C206.374 17.3013 206.21 18.4028 206.21 19.6734C206.21 20.944 206.379 22.0506 206.717 22.9933C207.055 23.936 207.542 24.6686 208.177 25.1912C208.823 25.7035 209.612 25.9597 210.544 25.9597Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M179.393 18.0133V31.4772H171.877V7.86916H179.024V12.2035H179.285C179.808 10.7587 180.699 9.62645 181.96 8.80672C183.22 7.97675 184.721 7.56177 186.463 7.56177C188.123 7.56177 189.563 7.93577 190.782 8.68376C192.011 9.42152 192.964 10.4564 193.641 11.7885C194.327 13.1103 194.665 14.6575 194.655 16.4302V31.4772H187.139V17.9057C187.149 16.5941 186.816 15.5694 186.14 14.8317C185.474 14.0939 184.547 13.7251 183.358 13.7251C182.569 13.7251 181.872 13.8993 181.268 14.2476C180.674 14.5858 180.213 15.0725 179.885 15.7078C179.567 16.3431 179.403 17.1116 179.393 18.0133Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M156.833 31.923C154.364 31.923 152.232 31.4362 150.439 30.4628C148.656 29.4792 147.283 28.0805 146.32 26.2669C145.367 24.443 144.891 22.2758 144.891 19.7654C144.891 17.3267 145.372 15.1954 146.335 13.3716C147.299 11.5374 148.656 10.1132 150.408 9.09875C152.161 8.07409 154.225 7.56177 156.602 7.56177C158.283 7.56177 159.82 7.82305 161.213 8.34563C162.607 8.8682 163.811 9.64182 164.825 10.6665C165.84 11.6911 166.629 12.9566 167.192 14.4628C167.756 15.9588 168.038 17.6751 168.038 19.6117V21.4868H147.519V17.1218H161.044C161.034 16.3226 160.845 15.6104 160.476 14.9854C160.107 14.3604 159.6 13.8736 158.954 13.5253C158.319 13.1666 157.586 12.9873 156.756 12.9873C155.916 12.9873 155.163 13.1769 154.497 13.556C153.831 13.9249 153.303 14.4321 152.914 15.0776C152.524 15.7129 152.319 16.4353 152.299 17.2448V21.6866C152.299 22.6498 152.488 23.4952 152.868 24.2227C153.247 24.9399 153.785 25.4984 154.481 25.898C155.178 26.2976 156.008 26.4974 156.971 26.4974C157.637 26.4974 158.242 26.4052 158.785 26.2207C159.328 26.0363 159.794 25.7648 160.184 25.4061C160.573 25.0475 160.865 24.6069 161.06 24.0843L167.961 24.2841C167.674 25.8314 167.044 27.1788 166.07 28.3264C165.107 29.4638 163.842 30.3501 162.274 30.9854C160.706 31.6104 158.893 31.923 156.833 31.923Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M141.515 15.0776L134.614 15.2621C134.543 14.7702 134.348 14.3347 134.03 13.9556C133.713 13.5662 133.298 13.264 132.785 13.0488C132.283 12.8234 131.699 12.7107 131.033 12.7107C130.162 12.7107 129.419 12.8849 128.805 13.2332C128.2 13.5816 127.903 14.053 127.913 14.6473C127.903 15.1084 128.087 15.508 128.466 15.8461C128.856 16.1842 129.547 16.4558 130.541 16.6607L135.091 17.5214C137.448 17.9723 139.2 18.7203 140.347 19.7654C141.505 20.8106 142.089 22.1939 142.1 23.9153C142.089 25.5342 141.608 26.9431 140.655 28.142C139.712 29.3408 138.421 30.2733 136.782 30.9393C135.142 31.5951 133.267 31.923 131.156 31.923C127.785 31.923 125.126 31.2313 123.179 29.848C121.243 28.4545 120.136 26.5896 119.859 24.2534L127.283 24.069C127.447 24.9297 127.872 25.5855 128.559 26.0363C129.245 26.4872 130.121 26.7126 131.187 26.7126C132.15 26.7126 132.934 26.5333 133.539 26.1746C134.143 25.816 134.45 25.3395 134.461 24.7452C134.45 24.2124 134.215 23.7872 133.754 23.4695C133.293 23.1417 132.57 22.8855 131.587 22.7011L127.467 21.9172C125.1 21.4868 123.338 20.6927 122.18 19.5349C121.022 18.3668 120.449 16.881 120.459 15.0776C120.449 13.4996 120.869 12.1522 121.719 11.0353C122.57 9.90823 123.779 9.04752 125.346 8.45322C126.914 7.85892 128.764 7.56177 130.895 7.56177C134.092 7.56177 136.612 8.23292 138.457 9.57521C140.301 10.9073 141.321 12.7414 141.515 15.0776Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M116.526 7.86936V11.5581H103.631V7.86936H116.526ZM107.089 2.21326H111.685V24.5456C111.685 25.4371 111.818 26.1082 112.084 26.5591C112.351 26.9997 112.694 27.302 113.114 27.4659C113.544 27.6196 114.011 27.6964 114.513 27.6964C114.882 27.6964 115.204 27.6708 115.481 27.6196C115.758 27.5684 115.973 27.5274 116.127 27.4966L116.957 31.293C116.69 31.3955 116.311 31.4979 115.819 31.6004C115.327 31.7131 114.713 31.7746 113.975 31.7848C112.766 31.8053 111.639 31.5901 110.593 31.1393C109.548 30.6884 108.703 29.9917 108.057 29.049C107.412 28.1063 107.089 26.9228 107.089 25.4986V2.21326Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M84.2343 17.4601V31.4774H79.6387V7.86929H84.0498V11.7117H84.3418C84.8849 10.4617 85.7354 9.4575 86.8932 8.69925C88.0613 7.94101 89.5317 7.56189 91.3044 7.56189C92.9131 7.56189 94.322 7.90003 95.5311 8.5763C96.7402 9.24232 97.6777 10.2362 98.3438 11.558C99.0098 12.8799 99.3428 14.5142 99.3428 16.461V31.4774H94.7472V17.0143C94.7472 15.3032 94.3015 13.966 93.4101 13.0028C92.5186 12.0294 91.2941 11.5427 89.7367 11.5427C88.671 11.5427 87.7232 11.7732 86.8932 12.2343C86.0735 12.6954 85.4229 13.3717 84.9413 14.2631C84.4699 15.1443 84.2343 16.21 84.2343 17.4601Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M64.4111 31.9538C62.0852 31.9538 60.082 31.4569 58.4015 30.4629C56.7313 29.4588 55.4403 28.0499 54.5283 26.2362C53.6266 24.4124 53.1758 22.2759 53.1758 19.827C53.1758 17.4088 53.6266 15.2775 54.5283 13.4332C55.4403 11.5888 56.7108 10.1491 58.34 9.11424C59.9795 8.07934 61.8956 7.56189 64.0884 7.56189C65.4204 7.56189 66.7115 7.78219 67.9616 8.22279C69.2116 8.66339 70.3336 9.35504 71.3276 10.2977C72.3215 11.2404 73.1053 12.4649 73.6791 13.9711C74.253 15.4671 74.5399 17.2859 74.5399 19.4274V21.0566H55.7733V17.6138H70.0365C70.0365 16.4047 69.7906 15.3339 69.2987 14.4015C68.8069 13.4588 68.1153 12.7159 67.2238 12.1728C66.3426 11.6298 65.3077 11.3582 64.1191 11.3582C62.828 11.3582 61.7009 11.6759 60.7377 12.3112C59.7848 12.9362 59.0471 13.7559 58.5245 14.7703C58.0122 15.7745 57.756 16.8658 57.756 18.0441V20.7338C57.756 22.3118 58.0327 23.6541 58.586 24.7607C59.1495 25.8674 59.9334 26.7127 60.9375 27.2968C61.9417 27.8706 63.1149 28.1575 64.4572 28.1575C65.3282 28.1575 66.1223 28.0345 66.8396 27.7886C67.5568 27.5324 68.1767 27.1533 68.6993 26.6512C69.2219 26.1491 69.6215 25.5292 69.8982 24.7915L74.2478 25.5753C73.8994 26.8562 73.2744 27.9782 72.3727 28.9413C71.4813 29.8943 70.3593 30.6371 69.0067 31.17C67.6644 31.6925 66.1326 31.9538 64.4111 31.9538Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M48.0546 0V31.4774H43.459V0H48.0546Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M25.6859 31.9998C24.1899 31.9998 22.8374 31.7231 21.6283 31.1698C20.4192 30.6063 19.4611 29.7917 18.7541 28.726C18.0574 27.6604 17.709 26.354 17.709 24.8067C17.709 23.4747 17.9651 22.3783 18.4775 21.5176C18.9898 20.6569 19.6814 19.9755 20.5524 19.4734C21.4234 18.9713 22.3968 18.5922 23.4727 18.336C24.5486 18.0799 25.6449 17.8852 26.7618 17.752C28.1758 17.588 29.3235 17.4548 30.2047 17.3524C31.0859 17.2396 31.7263 17.0603 32.1259 16.8144C32.5255 16.5685 32.7253 16.1689 32.7253 15.6156V15.508C32.7253 14.1657 32.3462 13.1256 31.5879 12.3879C30.84 11.6501 29.7231 11.2813 28.2373 11.2813C26.6901 11.2813 25.4708 11.6245 24.5793 12.311C23.6981 12.9873 23.0884 13.7404 22.7503 14.5704L18.4314 13.5867C18.9437 12.1522 19.6917 10.9944 20.6754 10.1132C21.6693 9.22171 22.8118 8.57617 24.1028 8.17656C25.3939 7.7667 26.7516 7.56177 28.1758 7.56177C29.1185 7.56177 30.1176 7.67448 31.173 7.8999C32.2386 8.11508 33.2325 8.5147 34.1547 9.09875C35.0871 9.6828 35.8505 10.5179 36.4448 11.604C37.0391 12.6799 37.3363 14.0786 37.3363 15.8V31.4772H32.8483V28.2496H32.6638C32.3667 28.8439 31.921 29.4279 31.3267 30.0017C30.7324 30.5755 29.969 31.052 29.0366 31.4311C28.1041 31.8102 26.9872 31.9998 25.6859 31.9998ZM26.685 28.311C27.9555 28.311 29.0417 28.06 29.9434 27.5579C30.8553 27.0558 31.547 26.4001 32.0183 25.5906C32.4999 24.7709 32.7407 23.8948 32.7407 22.9623V19.9191C32.5767 20.0831 32.2591 20.2368 31.7878 20.3802C31.3267 20.5134 30.799 20.6312 30.2047 20.7337C29.6104 20.8259 29.0314 20.913 28.4679 20.995C27.9043 21.0667 27.433 21.1282 27.0538 21.1794C26.1624 21.2922 25.3478 21.4817 24.61 21.7481C23.8825 22.0145 23.2985 22.3988 22.8579 22.9009C22.4275 23.3927 22.2123 24.0485 22.2123 24.8682C22.2123 26.0056 22.6325 26.8663 23.4727 27.4503C24.3129 28.0241 25.3837 28.311 26.685 28.311Z"
                                    fill="#EEF9E4"
                                />
                                <path
                                    d="M13.7332 7.86936V11.5581H0.837891V7.86936H13.7332ZM4.2961 2.21326H8.89169V24.5456C8.89169 25.4371 9.02489 26.1082 9.2913 26.5591C9.55771 26.9997 9.90097 27.302 10.3211 27.4659C10.7514 27.6196 11.2177 27.6964 11.7197 27.6964C12.0886 27.6964 12.4114 27.6708 12.688 27.6196C12.9647 27.5684 13.1799 27.5274 13.3336 27.4966L14.1635 31.293C13.8971 31.3955 13.518 31.4979 13.0262 31.6004C12.5343 31.7131 11.9195 31.7746 11.1818 31.7848C9.9727 31.8053 8.84558 31.5901 7.80043 31.1393C6.75528 30.6884 5.90994 29.9917 5.2644 29.049C4.61887 28.1063 4.2961 26.9228 4.2961 25.4986V2.21326Z"
                                    fill="#EEF9E4"
                                />
                            </svg>
                        </div>
                        <h2 tw="flex flex-col text-7xl">
                            <span tw="text-[#9FFB4F]">
                                {offer.targetFirstName},
                            </span>
                            <span tw="text-[#EEF9E4]">
                                here&apos;s your job offer from {offer.name}!
                            </span>
                        </h2>
                    </div>
                </div>
            </div>
        ),
        {
            width: 1200,
            height: 630,
            fonts: [
                {
                    name: 'Inter',
                    data: interBoldFont,
                    style: 'normal',
                    weight: 600,
                },
            ],
        },
    );
}
